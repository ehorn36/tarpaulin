# Tarpaulin RESTful API
Tarpaulin is a lightweight, RESTful course management API designed as a streamlined alternative to platforms like Canvas. It supports core functionality for managing users, enrollments, and course content. This RESTful API was built with Python 3, deployed on Google App Engine, and utilizes Google Cloud Datastore, Cloud Storage, and Auth0 for authentication.

**Note** - This project was built as a portfolio project for a cloud application development class. The server hosting this application has been shut down. Furthermore, the README file does not contain the required user credentials to authenticate with the API. 

---

## API Endpoints

The Tarpaulin API contains 13 endpoints. Most are protected and require a valid Auth0 JWT Bearer token. Each user has a role: `admin`, `instructor`, or `student`, which determines access permissions.

| #  | Method | Endpoint                      | Role Required     | Description                                       |
|----|--------|-------------------------------|-------------------|---------------------------------------------------|
| 1  | POST   | `/users/login`                | Public            | Authenticate a user and return JWT token          |
| 2  | GET    | `/users`                      | Admin             | Retrieve a list of all users                      |
| 3  | GET    | `/users/:id`                  | Admin, Owner      | Get detailed info for a user                      |
| 4  | POST   | `/users/:id/avatar`           | Owner             | Upload or update user avatar image                |
| 5  | GET    | `/users/:id/avatar`           | Public            | Retrieve the user’s avatar image                  |
| 6  | GET    | `/courses`                    | Any authenticated | Retrieve list of courses                          |
| 7  | POST   | `/courses`                    | Instructor        | Create a new course                               |
| 8  | GET    | `/courses/:id`                | Enrolled users    | Get details of a specific course                  |
| 9  | PATCH  | `/courses/:id`                | Instructor (owner)| Update details of a course                        |
|10  | DELETE | `/courses/:id`                | Instructor/Admin  | Delete a course                                   |
|11  | POST   | `/courses/:id/enroll`         | Student           | Enroll in a course                                |
|12  | DELETE | `/courses/:id/unenroll`       | Student           | Unenroll from a course                            |
|13  | GET    | `/courses/:id/roster`         | Instructor (owner)| Get list of students enrolled in a course         |

**Authorization Notes:**
- `Owner` means the user accessing the endpoint must be the owner of the resource (e.g., their own user record).
- For courses, ownership is determined by `instructorId`.

---

## Project Structure
```
tarpaulin_api/
├── app.yaml
├── main.py
├── models/
│ └── datastore.py
├── auth/
│ └── auth0.py
├── routes/
│ ├── users.py
│ └── courses.py
├── utils/
│ └── storage.py
├── requirements.txt
└── README.md
```

---

## Data Model

### Kind: `users`
Several pre-defined Auth0 users were created for this project. Roles include `admin`, `instructor`, and `student`.

| Property | Type     | Required | Notes                                            |
|----------|----------|----------|--------------------------------------------------|
| id       | Integer  | Yes      | Auto-generated by Datastore                      |
| sub      | String   | Yes      | Auth0 subject ID                                 |
| role     | String   | Yes      | `"admin"`, `"instructor"`, or `"student"`        |
| name     | String   | No       | Set via API                                      |
| email    | String   | No       | Set via API                                      |
| courses  | List     | No       | Course IDs the user is enrolled in or teaches    |
| avatar   | String   | No       | Name of the avatar file in GCS                   |

---

### Kind: `courses`
Represents a course created by an instructor.


| Property     | Type     | Required | Notes                                        |
|--------------|----------|----------|----------------------------------------------|
| id           | Integer  | Yes      | Auto-generated by Datastore                  |
| subjectCode  | String   | Yes      | Example: `"CS"`                              |
| number       | String   | Yes      | Example: `"361"`                             |
| title        | String   | Yes      | Example: `"Intro to Software Engineering"`   |
| instructorId | String   | Yes      | The `id` of the instructor (from `users`)    |
| students     | List     | No       | List of `user.id`s of enrolled students      |
| term         | String   | No       | Optional field to track term info            |

---

## Authentication

Tarpaulin uses **Auth0 JWT Bearer Tokens**. Most API endpoints are protected and require a valid JWT in the `Authorization` header.

- Auth0 tenant setup includes 9 users with roles mapped in Datastore.
- JWT validation is handled via middleware (`auth/auth0.py`).

To obtain a JWT, make a POST request to /users/login with valid Auth0 credentials. The returned token must be included in the Authorization header as:
```
Authorization: Bearer <your-token>
```

---

## Environment
A `.env` file stores environment variables securely in the root directory of the project.

```env
FLASK_APP=main.py
FLASK_ENV=development
CLIENT_ID=your-auth0-client-id
CLIENT_SECRET=your-auth0-client-secret
DOMAIN=your-auth0-domain
ALGORITHMS=RS256
PHOTO_BUCKET=your-google-cloud-storage-bucket
GOOGLE_CLOUD_PROJECT=your-gcp-project-id
```

---

## Example
GET request
```
curl -X GET https://example-api-url.com/users \
  -H "Content-Type: application/json" \
```
Server response
```
[
    {
        "id": 514988745645677,
        "role": "instructor",
        "sub": "auth0|6831cfaebaa0634k582e0af"
    },
    {
        "id": 514988745645984,
        "role": "admin",
        "sub": "auth0|6831ccebbe2c93399978379"
    }
]
```

---

## Acknowledgments
Portions of this README were developed with the assistance of ChatGPT by OpenAI.